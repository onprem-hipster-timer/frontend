# Contributing to Momeet Frontend

**[한국어 버전](CONTRIBUTING.ko.md)**

Thank you for your interest in contributing to Momeet Frontend. This document describes the contribution process and guidelines.

## Table of Contents

- [Before You Start](#before-you-start)
- [Development Environment](#development-environment)
- [Coding Standards](#coding-standards)
- [Commit Guidelines](#commit-guidelines)
- [Pull Request Process](#pull-request-process)
- [Review Process](#review-process)

---

## Before You Start

### Check Existing Issues

Before starting work, check if there's already an issue or PR for your intended change:

1. Search [existing issues](https://github.com/onprem-hipster-timer/frontend/issues)
2. Search [existing pull requests](https://github.com/onprem-hipster-timer/frontend/pulls)

If none exists, create an issue first to discuss the change.

### Issue First Policy

**All non-trivial changes require an issue first.**

- Bug fixes: Create a bug report issue
- New features: Create a feature request issue
- Documentation: Small fixes can go directly to PR

This ensures your work aligns with project direction and prevents duplicate effort.

---

## Development Environment

### Prerequisites

- [FVM](https://fvm.app/documentation/getting-started/installation) (Flutter Version Management)
- Git
- Android Studio or VS Code
- Android SDK (for Android builds)
- Xcode (macOS only, for iOS builds)

### Setup

```bash
# Fork and clone
git clone https://github.com/YOUR_USERNAME/frontend.git
cd frontend

# Install Flutter SDK via FVM
fvm install stable
fvm use stable

# Install dependencies
fvm flutter pub get

# Run code generation
fvm dart run build_runner build --delete-conflicting-outputs
```

### Running the App

```bash
# Check environment
fvm flutter doctor -v

# Run on connected device or emulator
fvm flutter run
```

### Running Tests

**All code changes must pass tests.**

```bash
# Run all tests
fvm flutter test

# Run specific test file
fvm flutter test test/widget_test.dart

# Run with coverage
fvm flutter test --coverage
```

### Running Architecture Lints

```bash
# Run architecture lint checks
fvm dart run custom_lint
```

Rules enforced:

| Rule | Description |
|------|-------------|
| `no_direct_supabase_auth` | Disallow direct Supabase auth API calls outside `auth_provider.dart` |
| `auth_notifier_build_structure` | Detect missing required structure in `AuthNotifier.build()` |
| `auth_action_no_state_mutation` | Disallow direct `state` mutation in action methods |
| `auth_action_no_loading_state` | Disallow `AuthStatus.loading()` in action methods |
| `auth_catch_require_classify` | Require `AuthErrorType.classify` in catch blocks |

> If the `custom_lint` plugin is active in your IDE, warnings will appear in real-time as you write code.

---

## Coding Standards

### Dart Style

This project follows the [Effective Dart](https://dart.dev/effective-dart) guidelines with the following specifics:

- Line length: 80 characters maximum (Dart default)
- Use type annotations for public APIs
- Use `///` doc comments for all public classes, methods, and properties
- Follow `analysis_options.yaml` linter rules

### Code Examples

```dart
// Good
/// Fetches the list of schedules within the given date range.
Future<List<ScheduleRead>> fetchSchedules({
  required DateTime startDate,
  required DateTime endDate,
}) async {
  // ...
}

// Bad
Future<List<ScheduleRead>> fetchSchedules(DateTime s, DateTime e) async {
  // ...
}
```

### Architecture Principles

1. **Feature-first**: Each feature is an independent module under `lib/features/`
2. **Riverpod for state**: Use `@riverpod` annotation for all providers
3. **Freezed for models**: Immutable data classes with `@freezed`
4. **FVM always**: All Flutter/Dart commands must use `fvm` prefix

### File Naming

| Type | Pattern | Example |
|------|---------|---------|
| Page | `lib/features/{feature}/presentation/pages/{name}_page.dart` | `calendar_page.dart` |
| Widget | `lib/features/{feature}/presentation/widgets/{name}.dart` | `schedule_card.dart` |
| Provider | `lib/features/{feature}/presentation/providers/{name}_provider.dart` | `calendar_providers.dart` |
| Model | `lib/shared/api/models/{name}.dart` | `schedule_read.dart` |
| API Client | `lib/shared/api/{feature}/{feature}_client.dart` | `schedules_client.dart` |

### Generated Files

- **Never manually edit** `*.freezed.dart` or `*.g.dart` files
- These are regenerated by `build_runner`
- Add them to `.gitignore` if they are not already tracked

---

## Commit Guidelines

### Commit Message Format

Follow the conventional commit format:

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types

| Type | Description |
|------|-------------|
| `feat` | New feature |
| `fix` | Bug fix |
| `docs` | Documentation only |
| `style` | Code style (formatting, no logic change) |
| `refactor` | Code change that neither fixes a bug nor adds a feature |
| `test` | Adding or updating tests |
| `chore` | Build process, dependencies, etc. |

### Examples

```
feat(calendar): add drag-and-drop schedule rescheduling

Implement drag-and-drop on calendar week view to allow
users to move schedules between time slots.

- Add DraggableEvent widget
- Add DroppableTimeSlot widget
- Update schedule_mutations provider

Closes #42
```

```
fix(todo): prevent circular reference in tree structure

The previous implementation allowed A→B→A parent cycles.
Now validates ancestor chain before setting parent.

Fixes #87
```

### Commit Principles

1. **Atomic commits**: Each commit should be a single logical change
2. **Buildable**: Each commit should pass all tests
3. **Descriptive**: Subject line describes what, body explains why
4. **Reference issues**: Use `Closes #N` or `Fixes #N` in footer

---

## Pull Request Process

### Before Submitting

- [ ] All tests pass (`fvm flutter test`)
- [ ] Code follows style guidelines (`fvm flutter analyze`)
- [ ] Architecture lints pass (`fvm dart run custom_lint`)
- [ ] New code has appropriate tests
- [ ] Code generation runs cleanly (`fvm dart run build_runner build --delete-conflicting-outputs`)
- [ ] Documentation updated if needed
- [ ] Commit messages follow guidelines
- [ ] Rebased on latest `dev`

### PR Title Format

Same as commit message subject:

```
feat(timer): add pause/resume functionality
fix(auth): handle Supabase token refresh failure
docs: update setup guide for macOS
```

### PR Description

Use the PR template. Include:

1. **Summary**: What this PR does
2. **Related Issue**: Link to issue (`Closes #N`)
3. **Changes**: List of changes made
4. **Test Plan**: How to verify the changes
5. **Screenshots**: If UI changes are involved

### Size Matters

- Keep PRs focused and reasonably sized
- Large changes should be split into logical, reviewable chunks
- If a PR grows too large, discuss splitting it

---

## Review Process

### What Reviewers Look For

1. **Correctness**: Does the code do what it claims?
2. **Tests**: Are edge cases covered?
3. **Architecture**: Does it follow project patterns (Riverpod, Freezed, feature-first)?
4. **Performance**: Any unnecessary rebuilds or expensive operations?
5. **UI/UX**: Does it follow Material Design guidelines?

### Responding to Reviews

- Address all comments before requesting re-review
- Explain your reasoning if you disagree
- Mark conversations as resolved after addressing

### Review Timeline

- Maintainers aim to provide initial review within 3-5 business days
- Complex PRs may take longer
- Ping in the PR if no response after a week

---

## Getting Help

- **Questions**: Open a [Discussion](https://github.com/onprem-hipster-timer/frontend/discussions)
- **Bugs**: Create an [Issue](https://github.com/onprem-hipster-timer/frontend/issues)
- **Security**: See [SECURITY.md](SECURITY.md)

---

*Good code comes from good reviews. Thank you for contributing.*
